// naff.js - version: (please see package.js) - author: Paul Smith - license: MIT
var naff=function(){"use strict";if("undefined"!=typeof rivets&&rivets.configure({prefix:"naff",preloadData:!0,rootInterface:".",templateDelimiters:["{{","}}"],handler:function(e,n,r){e=t(e);for(var o=r.keypath.replace(")","").split("("),i=o[1].split(","),a=0;a<i.length;a++)i[a]=s(i[a],e);if("undefined"==typeof e[o[0]])throw"Error: cannot find function '"+o[0]+"' in element scope";i.unshift(n),e[o[0]].apply(e,i)}}),!document.head.querySelector("style#naff-resolver")){var e=document.createElement("STYLE");e.setAttribute("id","naff-resolver"),e.innerHTML="*[resolve]{display:block;opacity:1;-webkit-transition:opacity 1s ease-in-out;-moz-transition:opacity 1s ease-in-out;transition:opacity 1s ease-in-out;}*[unresolved]{opacity:0;}",document.head.appendChild(e)}var t=function(e){if(e=l(e),!e)throw"Origin not found, please add starting point for scope lookup";for(var t=e;t.tagName&&!t.scope;)t=t.parentNode;return t.scope?t.scope:"[object ShadowRoot]"===t.toString()?t.host.scope:null},n=function(e,n){if(e=l(e),!e)throw"Origin not specified, please add starting point for scope lookup";for(var r=t(e).parentNode;!(!r.tagName||n&&r.tagName==n.toUpperCase()&&r.scope||!n&&r.scope);)r=r.parentNode;return r.scope?r.scope:"[object ShadowRoot]"===r.toString()?r.host.scope:null},r=function(e){var t=Object.create(HTMLElement.prototype);t.createdCallback=function(){this.hasAttribute("resolve")&&this.setAttribute("unresolved",""),this.scope=a(e)},t.attachedCallback=function(){var e=this;rivets.bind(e,e.scope),setTimeout(function(){e.removeAttribute("unresolved"),"undefined"!=typeof e.scope.ready&&e.scope.ready()},0)},document.registerElement(e.name,{prototype:t})},o=function(e){var t=Object.create(HTMLElement.prototype),n=document._currentScript.ownerDocument.querySelector("#"+e.name);t.createdCallback=function(){this.scope=a(e),n&&(i(this,n,e.shadowDom,e.dataBind),this.scope.template=this.shadowRoot?this.shadowRoot:this);var t=this.scope.host=this;this.scope.fire||(this.scope.fire=function(e,n){naff.fire.call(t,null,e,n)}),e.created&&this.scope.created(),c(this,"created")},t.attachedCallback=function(){e.attached&&this.scope.attached(),c(this,"attached")},t.detachedCallback=function(){e.detached&&this.scope.detached(),c(this,"detached")},t.attributeChangedCallback=function(t,n,r){e.attributeChanged&&this.scope.attributeChanged(t,n,r),c(this,t+"attributechanged",{name:t,oldVal:n,newVal:r})};var r={prototype:t};e["extends"]&&(r["extends"]=e["extends"]),document.registerElement(e.name,r)},i=function(e,t,n,r){if(e=d(e),!e)throw"Host custom element not specified, please add custom element reference or lookup";var o,i,a,c,s=!!n,l=e.hasAttribute("data-bind")||!!r,u=t.content.querySelectorAll("content[select]"),p=t.content.querySelector("content");if(u.length>0){o={};for(var f=0;f<u.length;f++)if(u[f].hasAttribute("select")){var h=u[f].getAttribute("select");c=e.querySelector(h),c&&(o[h]=c,c.parentNode.removeChild(c))}s?(i=e.createShadowRoot(),i.innerHTML=t.innerHTML):e.innerHTML=t.innerHTML;for(var m in o)a=s?i.querySelector("content[select="+m+"]"):e.querySelector("content[select="+m+"]"),o[m]&&a.parentNode.insertBefore(o[m],a),a.parentNode.removeChild(a)}else if(p){o=e.innerHTML,s?(i=e.createShadowRoot(),i.innerHTML=t.innerHTML):e.innerHTML=t.innerHTML,a=s?i.querySelector("content"):e.querySelector("content"),a.innerHTML=o;for(var v=document.createDocumentFragment();a.firstChild;)v.appendChild(a.firstChild);a.parentNode.replaceChild(v,a)}else s?(i=e.createShadowRoot(),i.innerHTML=t.innerHTML,"undefined"!=typeof window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.assert(i)):e.innerHTML=t.innerHTML;l&&"undefined"!=typeof rivets&&rivets.bind(s?i:e,e.scope)},a=function(e){if(null===e||"[object Object]"!==e.toString())return e;var t=e.constructor();for(var n in e)t[n]=a(e[n]);return t},c=function(e,t,n){e||(e=this),e.host&&(e=e.host);var r=n?new CustomEvent(t,{detail:n}):new Event(t);e.dispatchEvent(r)},s=function(e,t){if(e){if(e=e.trim(),/^[0-9]+$/i.test(e))return parseInt(e);if("true"==e||"false"==e)return"true"===e?!0:!1;if("null"==e)return null;if(/^(\'|\"){1}.*(\'|\"){1}$/.test(e))return e.substring(1,e.length-1);for(var n=e.split("."),r=t,o=0;o<n.length;o++)for(var i=n[o].split("["),a=0;a<i.length;a++){var c=/^[0-9 ]+$/i.test(i[a])?parseInt(i[a].replace(/[ ]/g,"")):i[a].replace(/[\'\"\] ]/g,"");r=r?r[c]:r}return r}},l=function(e){switch(typeof e){case"undefined":return null;case"string":return document.querySelector(e);case"object":return e.scope?e.parentNode:e}},d=function(e){switch(typeof e){case"undefined":return null;case"string":return document.querySelector(e);case"object":return e}};return{getScope:t,getParentScope:n,registerElement:o,registerApplication:r,applyTemplate:i,cloneObject:a,fire:c}}();
