// naff.js - version: (please see package.js) - author: Paul Smith - license: MIT
(function(){"use strict";"undefined"!=typeof rivets&&rivets.configure({prefix:"naff",preloadData:!0,rootInterface:".",templateDelimiters:["{{","}}"],handler:function(t,n,o){for(var r=o.keypath.replace(")","").split("("),i=r[1].split(","),a=0;a<i.length;a++)i[a]=l(i[a],t);for(t=e(t);t&&t.name!==o.model.name;)t=e(t.host.parentNode);if("undefined"==typeof t[r[0]])throw"Error: cannot find function '"+r[0]+"' in element scope '"+o.model.name+"'";i.unshift(n),t[r[0]].apply(t,i)}}),"undefined"!=typeof sightglass&&(sightglass.adapters=rivets.adapters,sightglass.root=".");var e=function(e){if(e=p(e),!e)throw"Origin not found, please add starting point for scope lookup";for(var t=e;t.tagName&&!t.scope;)t=t.parentNode;return t.scope?t.scope:"[object ShadowRoot]"===t.toString()?t.host.scope:null},t=function(t,n){if(t=p(t),!t)throw"Origin not specified, please add starting point for scope lookup";var o=e(t);if(o=e(o.host.parentNode),"undefined"!=typeof n)for(;o.parentNode&&o.host&&o.host.tagName!==n.toUpperCase();)o=e(o.parentNode);return o},n=function(e){var t=Object.create(HTMLElement.prototype);t.createdCallback=function(){this.hasAttribute("resolve")&&this.setAttribute("unresolved",""),this.scope=r(e),this.scope.host=this,"undefined"!=typeof this.scope.created&&this.scope.created()},t.attachedCallback=function(){if("function"==typeof this.scope.location){var e=s();this.scope.location.call(this.scope,e,null);var t=this;window.addEventListener("hashchange",function(n){t.scope.location.call(t.scope,s(),e),e=s()},!1)}var n=this;rivets.bind(n,n.scope),setTimeout(function(){n.hasAttribute("cloak")&&n.setAttribute("cloak","false"),"undefined"!=typeof n.scope.ready&&n.scope.ready(),i(n,"ready")},1)},document.registerElement(e.name,{prototype:t})},o=function(e){var t=Object.create(HTMLElement.prototype),n=document._currentScript.ownerDocument.querySelector("#"+e.name);t.createdCallback=function(){this.scope=r(e);var t=this.scope.host=this;this.scope.fire||(this.scope.fire=function(e,n){f.fire.call(t,null,e,n)}),e.created&&this.scope.created(),i(this,"created")},t.attachedCallback=function(){if("function"==typeof this.scope.location){var t=s();this.scope.location.call(this.scope,t,null);var o=this;window.addEventListener("hashchange",function(e){o.scope.location.call(o.scope,s(),t),t=s()},!1)}n&&(u(this,n,e.shadowDom,e.dataBind),this.scope.template=this.shadowRoot?this.shadowRoot:this);var r=this;setTimeout(function(){r.scope.host.hasAttribute("cloak")&&r.scope.host.setAttribute("cloak","false"),e.attached&&r.scope.attached(),i(r,"attached")},1)},t.detachedCallback=function(){e.detached&&this.scope.detached(),i(this,"detached")},t.attributeChangedCallback=function(t,n,o){e.attributeChanged&&this.scope.attributeChanged(t,n,o),i(this,t+"attributechanged",{name:t,oldVal:n,newVal:o})};var o={prototype:t};e["extends"]&&(o["extends"]=e["extends"]),document.registerElement(e.name,o)},r=function(e){if(null===e||"[object Object]"!==e.toString())return e;var t=e.constructor();for(var n in e)t[n]=r(e[n]);return t},i=function(e,t,n){e||(e=this),e.host&&(e=e.host);var o=n?new CustomEvent(t,{detail:n}):new Event(t);e.dispatchEvent(o)},a={token:null,ajax:function(e,t,n,o){e=e.toUpperCase();var r=new Promise(function(r,i){var s=XMLHttpRequest||ActiveXObject,c=new s("MSXML2.XMLHTTP.3.0");if(c.open(e,t,!0),"undefined"!=typeof o){null!==a.token&&(o.Authorization=a.token);for(var d in o)c.setRequestHeader(d,o[d])}c.onreadystatechange=function(){if(4===c.readyState){var e=c.responseText;if("undefined"!=typeof o["Content-Type"]&&o["Content-Type"].indexOf("json")>=0)try{e=JSON.parse(c.responseText)}catch(t){}a.token=this.getResponseHeader("Authorization"),200===c.status?r({data:e,response:c}):i({data:e,response:c})}},c.send(n)});return r},get:function(e,t){var n={"Content-Type":"application/json;charset=UTF-8","Cache-Control":"no-cache"};return this.ajax("GET",e+("undefined"!=typeof t&&null!==t?"/"+t:""),null,n)},put:function(e,t){var n={"Content-Type":"application/json;charset=UTF-8","Cache-Control":"no-cache"};try{t=JSON.stringify(t)}catch(o){}return this.ajax("PUT",e,t,n)},post:function(e,t){var n={"Content-Type":"application/json;charset=UTF-8","Cache-Control":"no-cache"};try{t=JSON.stringify(t)}catch(o){}return this.ajax("POST",e,t,n)},"delete":function(e,t){var n={"Content-Type":"application/json;charset=UTF-8","Cache-Control":"no-cache"};return this.ajax("DELETE",e+("undefined"!=typeof t&&null!==t?"/"+t:""),null,n)}},s=function(){var e=decodeURI(window.location.href);if(e.indexOf("#")<0)return{route:"",params:{}};var t=e.substring(e.indexOf("#")+1,e.length);if(t.indexOf("?")<0)return{route:t,params:{}};for(var n=t.substring(0,t.indexOf("?")),o={},r=t.substring(t.indexOf("?")+1,t.length).split("&"),i=0;i<r.length;i++){var a=r[i].split("=");if(!(a[0].length<1)){try{a[1]=JSON.parse(a[1])}catch(s){}o[a[0]]=a[1]||""}}return{route:n,params:o}},c=function(e){if("undefined"!=typeof e){var t=decodeURI(window.location.href),n=t.split("#")[0]+"#";if(n+="undefined"!=typeof e.route?e.route:t.indexOf("#")<0?"":t.substring(t.indexOf("#")+1,t.length).split("?")[0],"undefined"!=typeof e.params){n+="?";for(var o in e.params)n+=o+"="+JSON.stringify(e.params[o])+"&";n=n.substring(0,n.length-1)}window.location.href=encodeURI(n)}},d={get:function(e){if(!e)return null;var t=new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$");return decodeURIComponent(document.cookie.replace(t,"$1"))||null},set:function(e,t,n,o,r,i){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var a="";return"undefined"!=typeof n&&(n.constructor==Number&&(a=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n),n.constructor==String&&(a="; expires="+n),n.constructor==Date&&(a="; expires="+n.toUTCString())),r=r?"; domain="+r:"",o=o?"; path="+o:"",i=i?"; secure":"",document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+a+r+o+i},remove:function(e,t,n){return d.has(e)?(n=n?"; domain="+n:"",t=t?"; path="+t:"",document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+n+t):!1},has:function(e){if(!e)return!1;var t=new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=");return t.test(document.cookie)}},u=function(e,t,n,o){if(e=p(e),!e)throw"Host custom element not specified, please add custom element reference or lookup";var r,i,a,s,c=!!n,d=e.hasAttribute("data-bind")||!!o,u=t.content.querySelectorAll("content[select]"),l=t.content.querySelector("content");if(u.length>0){r={};for(var f=0;f<u.length;f++)if(u[f].hasAttribute("select")){var h=u[f].getAttribute("select");s=e.querySelector(h),s&&(r[h]=s,s.parentNode.removeChild(s))}c?(i=e.createShadowRoot(),i.innerHTML=t.innerHTML):e.innerHTML=t.innerHTML,d&&"undefined"!=typeof rivets&&rivets.bind(c?i:e,e.scope);for(var m in r)a=c?i.querySelector("content[select="+m+"]"):e.querySelector("content[select="+m+"]"),r[m]&&a.parentNode.insertBefore(r[m],a),a.parentNode.removeChild(a)}else if(l){for(r=document.createDocumentFragment();e.firstChild;)r.appendChild(e.firstChild);c?(i=e.createShadowRoot(),i.innerHTML=t.innerHTML):e.innerHTML=t.innerHTML,d&&"undefined"!=typeof rivets&&rivets.bind(c?i:e,e.scope),a=c?i.querySelector("content"):e.querySelector("content");for(var g=document.createDocumentFragment();r.firstChild;)g.appendChild(r.firstChild);a.parentNode.replaceChild(g,a)}else c?(i=e.createShadowRoot(),i.innerHTML=t.innerHTML,"undefined"!=typeof window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.assert(i)):e.innerHTML=t.innerHTML,d&&"undefined"!=typeof rivets&&rivets.bind(c?i:e,e.scope)},l=function(e,t){if(e){if(e=e.trim(),/^[0-9]+$/i.test(e))return parseInt(e);if("true"==e||"false"==e)return"true"===e?!0:!1;if("null"==e)return null;if(/^(\'|\"){1}.*(\'|\"){1}$/.test(e))return e.substring(1,e.length-1);for(var n=e.split("."),o=t,r=0;r<n.length;r++)for(var i=n[r].split("["),a=0;a<i.length;a++){var s=/^[0-9 ]+$/i.test(i[a])?parseInt(i[a].replace(/[ ]/g,"")):i[a].replace(/[\'\"\] ]/g,"");o=o?o[s]:o}return o}},p=function(e){switch(typeof e){case"undefined":return null;case"string":return document.querySelector(e);case"object":return e}},f={getScope:e,getParentScope:t,registerElement:o,registerApplication:n,cloneObject:r,fire:i,request:a,getLocation:s,setLocation:c,cookie:d};"undefined"!=typeof module&&module.exports?module.exports=f:"function"==typeof define&&define.amd?define([],function(){return this.naff=f}):this.naff=f}).call(this);
