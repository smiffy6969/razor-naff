// naff.js - version: (please see package.js) - author: Paul Smith - license: MIT
var naff=function(){"use strict";if("undefined"!=typeof rivets&&rivets.configure({prefix:"naff",preloadData:!0,rootInterface:".",templateDelimiters:["{{","}}"],handler:function(a,c,d){for(var a=b(a),e=d.keypath.replace(")","").split("("),f=e[1].split(","),g=0;g<f.length;g++)f[g]=i(f[g],a);f.unshift(c),a[e[0]].apply(a,f)}}),!document.head.querySelector("style#naff-resolver")){var a=document.createElement("STYLE");a.setAttribute("id","naff-resolver"),a.innerHTML="*[resolve]{display:block;opacity:1;-webkit-transition:opacity 1s ease-in-out;-moz-transition:opacity 1s ease-in-out;transition:opacity 1s ease-in-out;}*[unresolved]{opacity:0;}",document.head.appendChild(a)}var b=function(a){if(a=j(a),!a)throw"Origin not found, please add starting point for scope lookup";for(var b=a;b.tagName&&!b.scope;)b=b.parentNode;return b.scope?b.scope:"[object ShadowRoot]"===b.toString()?b.host.scope:null},c=function(a,c){if(a=j(a),!a)throw"Origin not specified, please add starting point for scope lookup";for(var d=b(a).parentNode;!(!d.tagName||c&&d.tagName==c.toUpperCase()&&d.scope||!c&&d.scope);)d=d.parentNode;return d.scope?d.scope:"[object ShadowRoot]"===d.toString()?d.host.scope:null},d=function(a){var b=Object.create(HTMLElement.prototype);b.createdCallback=function(){this.hasAttribute("resolve")&&this.setAttribute("unresolved",""),this.scope=g(a)},b.attachedCallback=function(){var a=this;rivets.bind(a,a.scope),setTimeout(function(){a.removeAttribute("unresolved"),"undefined"!=typeof a.scope.ready&&a.scope.ready()},0)},document.registerElement(a.name,{prototype:b})},e=function(a){var b=Object.create(HTMLElement.prototype),c=document._currentScript.ownerDocument.querySelector("#"+a.name);b.createdCallback=function(){this.scope=g(a),c&&(f(this,c,a.shadowDom,a.dataBind),this.scope.template=this.shadowRoot?this.shadowRoot:this);var b=this.scope.host=this;this.scope.fire||(this.scope.fire=function(a,c){naff.fire.call(b,null,a,c)}),a.created&&this.scope.created()},b.attachedCallback=function(){a.attached&&this.scope.attached()},b.detachedCallback=function(){a.detached&&this.scope.detached()},b.attributeChangedCallback=function(b,c,d){a.attributeChanged&&this.scope.attributeChanged(b,c,d)};var d={prototype:b};a.extends&&(d.extends=a.extends),document.registerElement(a.name,d)},f=function(a,b,c,d){if(a=k(a),!a)throw"Host custom element not specified, please add custom element reference or lookup";var e=!!c,f=a.hasAttribute("data-bind")||!!d,g=b.content.querySelectorAll("content[select]"),h=b.content.querySelector("content");if(g.length>0){for(var i={},j=0;j<g.length;j++)if(g[j].hasAttribute("select")){var l=g[j].getAttribute("select");i[l]=a.querySelector(l)}if(e){var m=a.createShadowRoot();m.innerHTML=b.innerHTML}else a.innerHTML=b.innerHTML;for(var n in i){var o=e?m.querySelector("content[select="+n+"]"):a.querySelector("content[select="+n+"]");o.parentNode.insertBefore(i[n],o),o.parentNode.removeChild(o)}}else if(h){var i=a.innerHTML;if(e){var m=a.createShadowRoot();m.innerHTML=b.innerHTML}else a.innerHTML=b.innerHTML;var o=e?m.querySelector("content"):a.querySelector("content");o.innerHTML=i;for(var p=document.createDocumentFragment();o.firstChild;)p.appendChild(o.firstChild);o.parentNode.replaceChild(p,o)}else if(e){var m=a.createShadowRoot();m.innerHTML=b.innerHTML,"undefined"!=typeof window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.assert(m)}else a.innerHTML=b.innerHTML;f&&"undefined"!=typeof rivets&&rivets.bind(e?m:a,a.scope)},g=function(a){if(null===a||"[object Object]"!==a.toString())return a;var b=a.constructor();for(var c in a)b[c]=g(a[c]);return b},h=function(a,b,c){a||(a=this),a.host&&(a=a.host);var d=c?new CustomEvent(b,{detail:c}):new Event(b);a.dispatchEvent(d)},i=function(a,b){if(a){if(a=a.trim(),/^[0-9]+$/i.test(a))return parseInt(a);if("true"==a||"false"==a)return"true"===a?!0:!1;if("null"==a)return null;if(/^(\'|\"){1}.*(\'|\"){1}$/.test(a))return a.substring(1,a.length-1);for(var c=a.split("."),d=b,e=0;e<c.length;e++)for(var f=c[e].split("["),g=0;g<f.length;g++){var h=/^[0-9 ]+$/i.test(f[g])?parseInt(f[g].replace(/[ ]/g,"")):f[g].replace(/[\'\"\] ]/g,"");d=d?d[h]:d}return d}},j=function(a){switch(typeof a){case"undefined":return null;case"string":return document.querySelector(a);case"object":return a.scope?a.parentNode:a}},k=function(a){switch(typeof a){case"undefined":return null;case"string":return document.querySelector(a);case"object":return a}};return{getScope:b,getParentScope:c,registerElement:e,registerApplication:d,applyTemplate:f,cloneObject:g,fire:h}}();