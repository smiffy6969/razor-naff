// sightglass.js - version: 0.2.4 - author: Michael Richards - license: https://github.com/mikeric/sightglass/blob/master/LICENSE - updated: Paul Smith (smiffy6969) for razorNAFF
!function(){function a(a,c,d,e){return new b(a,c,d,e)}function b(a,b,d,e){this.options=e||{},this.options.adapters=this.options.adapters||{},this.obj=a,this.keypath=b,this.callback=d,this.objectPath=[],this.parse(),c(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function c(a){return"object"==typeof a&&null!==a}function d(a){throw new Error("[sightglass] "+a)}a.adapters={},b.tokenize=function(a,b,c){var f,g,d=[],e={i:c,path:""};for(f=0;f<a.length;f++)g=a.charAt(f),~b.indexOf(g)?(d.push(e),e={i:g,path:""}):e.path+=g;return d.push(e),d},b.prototype.parse=function(){var e,f,c=this.interfaces();c.length||d("Must define at least one adapter interface."),~c.indexOf(this.keypath[0])?(e=this.keypath[0],f=this.keypath.substr(1)):("undefined"==typeof(e=this.options.root||a.root)&&d("Must define a default root adapter."),f=this.keypath),this.tokens=b.tokenize(f,c,e),this.key=this.tokens.pop()},b.prototype.realize=function(){var d,a=this.obj,b=!1;return this.tokens.forEach(function(e,f){c(a)?("undefined"!=typeof this.objectPath[f]?a!==(d=this.objectPath[f])&&(this.set(!1,e,d,this.update.bind(this)),this.set(!0,e,a,this.update.bind(this)),this.objectPath[f]=a):(this.set(!0,e,a,this.update.bind(this)),this.objectPath[f]=a),a=this.get(e,a)):(b===!1&&(b=f),(d=this.objectPath[f])&&this.set(!1,e,d,this.update.bind(this)))},this),b!==!1&&this.objectPath.splice(b),a},b.prototype.update=function(){var a,b;(a=this.realize())!==this.target&&(c(this.target)&&this.set(!1,this.key,this.target,this.callback),c(a)&&this.set(!0,this.key,a,this.callback),b=this.value(),this.target=a,this.value()!==b&&this.callback())},b.prototype.value=function(){return c(this.target)?this.get(this.key,this.target):void 0},b.prototype.setValue=function(a){c(this.target)&&this.adapter(this.key).set(this.target,this.key.path,a)},b.prototype.get=function(a,b){return this.adapter(a).get(b,a.path)},b.prototype.set=function(a,b,c,d){var e=a?"observe":"unobserve";this.adapter(b)[e](c,b.path,d)},b.prototype.interfaces=function(){var b=Object.keys(this.options.adapters);return Object.keys(a.adapters).forEach(function(a){~b.indexOf(a)||b.push(a)}),b},b.prototype.adapter=function(b){return this.options.adapters[b.i]||a.adapters[b.i]},b.prototype.unobserve=function(){var a;this.tokens.forEach(function(b,c){(a=this.objectPath[c])&&this.set(!1,b,a,this.update.bind(this))},this),c(this.target)&&this.set(!1,this.key,this.target,this.callback)},"undefined"!=typeof module&&module.exports?module.exports=a:"function"==typeof define&&define.amd?define([],function(){return this.sightglass=a}):this.sightglass=a}.call(this);